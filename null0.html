<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Archive of Null</title>
    <!-- FAVICON LINK -->
    <link rel="icon" type="image/png" href="https://i.ibb.co/D3yJSP2/ezgif-1561cebd07b8392d.png">
    <!-- Load Roboto Mono for the classic terminal/glitch aesthetic -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;700&display=swap" rel="stylesheet">
    <!-- Load Tone.js for ambient audio effects -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --red-glow: #ff4444;
            --dark-red: #880000;
            --bg-color: #000000;
            --text-color: #E0E0E0; /* Brighter for readability */
        }

        html, body {
            margin: 0;
            padding: 0;
            height: 100%;
            font-family: 'Roboto', monospace; /* Swapped to Roboto for UI, Mono for terminal */
            background: var(--bg-color);
            color: var(--text-color);
            overflow: hidden; 
        }

        #container { 
            position: relative; 
            min-height: 100vh;
            transition: opacity 1.5s ease-out; 
            /* Added continuous, subtle horizontal shake */
            animation: crt-shake 0.2s infinite; 
        }
        
        /* --- CRT Effect (Updated and Animated) --- */
        #container::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 100;
            opacity: 0.18; /* Increased opacity slightly */
            
            /* Animated Scanlines */
            background: 
                repeating-linear-gradient(
                    0deg, 
                    rgba(0,0,0,0.6), 
                    rgba(0,0,0,0.6) 2px, 
                    transparent 2px, 
                    transparent 4px
                ),
                radial-gradient(
                    ellipse at center, 
                    rgba(0,0,0,0) 0%, 
                    rgba(0,0,0,0.7) 100%
                );
            background-size: 100% 4px; /* Ensure lines are spaced */
            animation: crt-flicker 15s infinite alternate, scanlines-scroll 5s linear infinite; 
        }
        
        /* New pseudo-element for screen curvature/border glow */
        #container::after {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99; 
            box-shadow: 0 0 80px rgba(255, 68, 68, 0.1) inset; 
        }
        
        @keyframes crt-flicker {
            0% { opacity: 0.18; }
            5% { opacity: 0.22; }
            10% { opacity: 0.18; }
            95% { opacity: 0.18; }
            100% { opacity: 0.2; }
        }
        
        @keyframes scanlines-scroll {
            from { background-position: 0 0; }
            to { background-position: 0 100vh; }
        }

        @keyframes crt-shake {
            0% { transform: translate(1px, 0); }
            50% { transform: translate(-1px, 0); }
            100% { transform: translate(1px, 0); }
        }
        /* --- End CRT Effect --- */


        .overlay {
            position: fixed; 
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 2;
            pointer-events: none;
            background: rgba(0,0,0,0.02);
        }

        .page {
            width: 100%;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2em;
            transition: opacity 1s ease, transform 1s ease;
            z-index: 3;
            box-sizing: border-box;
            /* Set position to be able to fade in/out */
            position: fixed;
            top: 0;
            left: 0;
        }

        #start-page {
            /* Now uses .page styles, so no need for duplicate fixed/top/left */
            background: var(--bg-color);
        }
        
        /* Main Terminal Section */
        #archive-terminal {
            /* This is no longer a page overlay, but the main scrollable content area */
            padding: 40px 20px;
            text-align: left;
            opacity: 0;
            transition: opacity 1s ease;
            min-height: 100vh;
            /* Remove fixed positioning to allow scrolling */
            position: relative;
            z-index: 1;
            /* Add this to make it invisible but exist for the fade-in */
            visibility: hidden;
        }
        
        .section-content {
            max-width: 800px;
            margin: 40px auto;
            border-left: 2px solid var(--red-glow);
            padding-left: 20px;
            /* Added transitions for opacity and transform */
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }
        
        .terminal-header {
            color: #4CAF50; /* Green command line */
            font-size: 1.5em;
            margin-bottom: 20px;
            font-family: 'Roboto Mono', monospace; /* Terminal-specific font */
        }
        
        /* --- Added .flex-row for button layout --- */
        .flex-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 1em;
        }

        /* --- Updated .active and .hidden for transitions --- */
        .active { 
            opacity: 1; 
            transform: scale(1);
            pointer-events: auto; 
            visibility: visible;
        }
        .hidden { 
            opacity: 0; 
            pointer-events: none; 
            transform: scale(0.98); /* Subtle zoom out */
            /* Use visibility: hidden to remove from layout */
            visibility: hidden;
            /* Add position: absolute to allow stacking/fading */
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
        }

        h1 { font-size: 3.5em; color: var(--red-glow); text-shadow: 0 0 15px var(--red-glow); margin-bottom: 0.5em;}
        h2 { font-size: 2em; color: var(--red-glow); margin-top: 40px; text-shadow: 0 0 5px var(--dark-red); }
        h3 { font-size: 1.5em; color: #ff6666; margin-top: 30px;}
        
        p, .main-text, .section-content p { 
            max-width: 700px; 
            font-size: 1.1em; 
            color: var(--text-color); 
            line-height: 1.7; /* Improved line height for readability */
            text-align: left;
            margin: 1.2em auto;
            font-family: 'Roboto', 'Helvetica Neue', sans-serif; /* More readable font for prose */
        }
        
        /* --- Terminal-specific text should be monospace --- */
        .terminal-header, .terminal-link, .code-digit, input[type="text"], #cipher-output, #search-output {
             font-family: 'Roboto Mono', monospace;
        }
        
        .main-text { padding-bottom: 50vh; } 
        
        /* Updated links for accessibility and styling */
        a, .terminal-link { 
            color: #ff6666; 
            text-decoration: none; 
            margin: 1em; 
            cursor: pointer;
            padding: 0.5em 1em;
            border: 1px solid #ff6666;
            transition: all 0.3s ease;
            display: inline-block;
        }
        a:hover, .terminal-link:hover { 
            color: #ff0000; 
            border-color: #ff0000;
            background: rgba(255, 0, 0, 0.1);
            text-shadow: 0 0 5px #ff0000; 
        }

        /* UPDATED: Subtle Highlight for Code Digits */
        .code-digit {
            color: var(--text-color); /* Keep the base color the same */
            font-weight: 700;
            text-shadow: 0 0 1px var(--red-glow); /* Very faint red glow */
            animation: subtle-flicker 2s infinite alternate; /* Slower, less aggressive flicker */
        }
        @keyframes subtle-flicker {
            0% { opacity: 1; }
            50% { opacity: 0.9; text-shadow: 0 0 2px var(--red-glow); }
            100% { opacity: 1; }
        }

        /* Cipher Input Styling */
        input[type="text"] {
            background: rgba(255, 68, 68, 0.1);
            border: 1px dashed var(--red-glow);
            color: var(--text-color);
            padding: 10px;
            font-size: 1.2em;
            width: 250px;
            text-align: center;
        }
        
        #cipher-output {
            color: #4CAF50;
            margin-top: 20px;
            font-weight: bold;
            min-height: 30px;
        }

        /* Rift and Glitch Effects (Fixed to viewport) */
        .rift {
            position: fixed; width: 150px; height: 150px; border: 2px dashed var(--red-glow); box-shadow: 0 0 25px var(--red-glow); border-radius: 50%; opacity: 0.2; pointer-events: none; z-index: 4; transition: transform 0.2s ease, opacity 0.2s ease;
        }
        .overlay-text { position: fixed; font-size: 2em; color: var(--red-glow); text-shadow: 0 0 10px var(--red-glow); pointer-events: none; z-index: 5;}
        .glitch { position: fixed; font-size: 1.5em; color: #ff6666; text-shadow: 0 0 5px var(--red-glow); pointer-events: none; z-index: 6; opacity: 0;}
        /* Increased z-index of flash for jump scare */
        .flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg-color); z-index: 101; opacity: 0; pointer-events: none; transition: opacity 0.05s ease-in-out;}
        .corrupt { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 6; mix-blend-mode: color-dodge;}
    </style>
</head>
<body> <!-- Removed onload attribute -->
<div id="container">
    <div class="overlay" id="overlay"></div>
    <div class="flash" id="flash"></div>
    <canvas class="corrupt" id="corruptCanvas"></canvas>

    <!-- Initial Landing Page -->
    <!-- Added 'active' class to start -->
    <div id="start-page" class="page active">
        <h1>...The Void Gate...</h1>
        <p>You have stumbled upon an unindexed node. A place of static and echo, where data structure fails and the Archive bleeds through.<br>Do you really want to sever this connection and leave?</p>
        <div class="flex-row"> <!-- Using the new flex-row class -->
            <!-- Updated 'a' tags for better accessibility/functionality -->
            <a href="#" onclick="triggerLeave(event)">Disconnect</a>
            <a href="#" onclick="triggerEnter(event)">Step Deeper</a>
        </div>
    </div>

    <!-- Main ARG Terminal Content -->
    <!-- Added 'hidden' class to start -->
    <div id="archive-terminal" class="hidden">
        <!-- Made this section active by default when terminal shows -->
        <div class="section-content active" id="index-section">
            <h2 id="section-index">ARCHIVE INDEX: ACCESSING // ROOT DIRECTORY [INIT]</h2>
            <div class="terminal-header">> list -d /archive/fragments/</div>
            
            <p>001. <span class="terminal-link" onclick="showSection('journal-fragment')">FRAGMENT 4.1 (OBSERVER'S JOURNAL)</span> <span id="file-size-display">[Size: 0.0KB]</span> [Security: LOW]</p>
            <p>002. <span class="terminal-link" onclick="showSection('cipher-protocol')">PROTOCOL: CIPHER-GATEMARK</span> [Size: 1.1KB] [Security: HIGH] **&lt; LOCKED &gt;**</p>
            <p>003. <span class="terminal-link" onclick="handleSearchClick(event)">SEARCH: NULL VECTOR</span> [Size: 0.0KB] [Security: UNKNOWN]</p>
            
            <p id="search-output" style="color: #ff0000; font-size: 0.9em; margin-top: 15px;">> </p>
            <p style="margin-top: 40px;"><span class="terminal-link" onclick="returnToStartPage()">Return to Void Gate</span></p>
        </div>

        <!-- Added 'hidden' class to start -->
        <div class="section-content hidden" id="journal-fragment">
            <h2>FRAGMENT 4.1 (OBSERVER'S JOURNAL)</h2>
            <p style="color: var(--dark-red); font-size: 1em; margin-top: 0;">[ACCESS LEVEL: UNSAFE // TIMESTAMP: 1989.11.05.03:17:34 Z]</p>
            <div class="main-text" id="journal-content-target">
                <p>The signal is louder now. It's not noise, it's—it's **structure**. A deep, resonating hum that feels less like sound and more like a pressure behind the eyes. It's been <span class="code-digit">9</span> days since the main frame was isolated, but the data leakage continues. Every scroll, every input, pushes another fragment of my research into the network, and something else... something *from* the network—is pushing back.</p>
                <p>I tried to implement the **Parallax Dissonance Filter** (PFD-**21**), hoping to stabilize the viewport, but it only amplified the distortion. Now, the rifts appear fixed to my vision, moving contrary to the text I'm trying to read. For <span class="code-digit">5</span> seconds the screen blanked. It mocks my efforts, a silent, swirling tear in the digital space. The corruption layer is no longer just on the display; I see it in the margins of my own handwritten notes.</p>
                <p>My primary concern is the **Glitch Text**. It appears randomly, too fast to decipher, always fragments of common errors—**404**, EOF, ???. But sometimes—<span class="code-digit">3</span> times this hour—a word slips through, a coherent command. Today it was *WATCH*. Yesterday it was *LISTEN*. I've disabled all speakers and microphones, but the constant, low-frequency pressure persists. It's not a suggestion. It's—<span class="code-digit">1</span> instruction. </p>
                <p style="margin-top: 50px; color: #ff0000; font-style: italic;">The four required digits are isolated single numbers found near the Observer's most urgent temporal (time-based) notations.</p>
                <p style="margin-top: 10px;"><span class="terminal-link" onclick="showSection('index-section')">-- BACK TO INDEX --</span></p>
            </div>
        </div>

        <!-- Added 'hidden' class to start -->
        <div class="section-content hidden" id="cipher-protocol" style="text-align: center;">
            <h2>PROTOCOL: CIPHER-GATEMARK</h2>
            <p>Access requires four-digit sequence found within an accessible fragment. Enter the key below to decode the final broadcast.</p>
            
            <!-- Changed to oninput for better validation -->
            <input type="text" id="cipher-input" maxlength="4" placeholder="[ _ _ _ _ ]" oninput="checkCipherInput(this)">
            <button class="terminal-link" onclick="attemptCipher()">DECODE SIGNAL</button>
            
            <p id="cipher-output">Awaiting Key...</p>
            
            <div id="final-message" style="margin-top: 40px; color: var(--red-glow); font-size: 1.5em; display: none;">
                <p>*** SEQUENCE DECODED ***</p>
                <p>THE NULL VECTOR IS NOT A PLACE, IT IS A STATE. THE SIGNAL IS YOUR EXIT. THANK YOU FOR LISTENING.</p>
            </div>
            
            <p style="margin-top: 50px;"><span class="terminal-link" onclick="showSection('index-section')">-- BACK TO INDEX --</span></p>
        </div>
    </div>
</div>

<script>
    // --- Setup and Constants ---
    const startPage = document.getElementById('start-page');
    const archiveTerminal = document.getElementById('archive-terminal');
    const container = document.getElementById('container');
    const canvas = document.getElementById('corruptCanvas');
    const flash = document.getElementById('flash');
    const ctx = canvas.getContext('2d');
    const CIPHER_KEY = "9531"; // The required key for the puzzle

    let isExperienceActive = false;
    let audioContextReady = false;
    let staticSound;

    // --- Dynamic Elements (Rifts, Glitch Text) Setup ---
    const overlay = document.getElementById('overlay');
    const rifts = [];
    for (let i = 0; i < 8; i++) {
        const rift = document.createElement('div');
        rift.className = 'rift';
        rift.style.top = Math.random() * 80 + 10 + 'vh';
        rift.style.left = Math.random() * 80 + 10 + 'vw';
        rift.style.opacity = 0.1 + Math.random() * 0.2;
        overlay.appendChild(rift);
        rifts.push(rift);
    }
    const glitchTexts = [];
    for(let i = 0; i < 10; i++) {
        const g = document.createElement('div');
        g.className = 'glitch';
        g.innerText = ["ERROR", "404", "NULL", ">>>", "!!!", "EOF", "§§§", "WAIT", "HELP", "STATIC"][i%10];
        g.style.top = Math.random()*100 + 'vh';
        g.style.left = Math.random()*100 + 'vw';
        overlay.appendChild(g);
        glitchTexts.push(g);
    }
    
    // --- Initializers and Helpers ---

    function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    
    function initAudio() {
        if (audioContextReady || Tone.context.state === 'running') return;
        try {
            // Start audio context on user gesture
            Tone.start(); 
            
            staticSound = new Tone.Noise('brown').start();
            const filter = new Tone.Filter(200, 'lowpass').toDestination();
            const tremolo = new Tone.Tremolo(2, 0.5).start();
            staticSound.connect(tremolo);
            tremolo.connect(filter);
            staticSound.volume.value = -30; 
            audioContextReady = true;
            console.log("Audio context started.");
        } catch (e) {
            console.error('Tone.js initialization failed:', e);
        }
    }

    /**
     * Calculates the "file size" based on the character count of the journal entry.
     * Uses textContent for better performance and accuracy.
     */
    function calculateFileSize() {
        const contentElement = document.getElementById('journal-content-target');
        const displayElement = document.getElementById('file-size-display');
        
        if (!contentElement || !displayElement) {
            console.error("Content or display element not found for size calculation.");
            return;
        }

        // Use textContent, which is faster and more accurate for raw text length
        const rawText = contentElement.textContent;
        
        // Simple estimation: 1 character ~ 1 byte for basic ASCII text
        const byteSize = rawText.length; 
        
        // Convert to KB (1024 bytes) and format to one decimal place
        const kbSize = (byteSize / 1024).toFixed(1);

        displayElement.innerText = `[Size: ${kbSize}KB]`;
    }

    // --- Navigation and Puzzle Logic ---
    
    /**
     * Shows a specific content section by ID, hiding all others.
     * Now uses class toggling for CSS transitions.
     */
    function showSection(id) {
        document.querySelectorAll('.section-content').forEach(section => {
            if (section.id === id) {
                section.classList.add('active');
                section.classList.remove('hidden');
            } else {
                section.classList.add('hidden');
                section.classList.remove('active');
            }
        });
        // Scroll to top on section change for better UX
        window.scrollTo({ top: 0, behavior: 'smooth' }); 
    }

    /**
     * Handles the "SEARCH: NULL VECTOR" click.
     */
    function handleSearchClick(event) {
        if (event) event.preventDefault();
        console.log('Searching...');
        document.getElementById('search-output').innerText = '> ERR: NODE UNAVAILABLE. TARGETING NODE 4.1...';
        // Optional: clear message after a delay
        setTimeout(() => {
            document.getElementById('search-output').innerText = '>';
        }, 3000);
    }

    /**
     * Validates cipher input to only allow numbers.
     * Renamed from checkCipherLength for clarity and uses oninput.
     */
    function checkCipherInput(input) {
        input.value = input.value.replace(/[^0-9]/g, '').substring(0, 4);
    }

    function attemptCipher() {
        const input = document.getElementById('cipher-input').value;
        const output = document.getElementById('cipher-output');
        const finalMessage = document.getElementById('final-message');
        
        output.style.color = 'var(--red-glow)';
        finalMessage.style.display = 'none';

        if (input.length !== 4) {
            output.innerText = "Error: Key length invalid.";
        } else if (input === CIPHER_KEY) {
            output.innerText = "Status: KEY ACCEPTED. DECODING...";
            output.style.color = '#4CAF50';
            // Play a short tone burst to indicate success
            try {
                if (!audioContextReady) initAudio(); // Ensure audio is ready
                const synth = new Tone.Synth().toDestination();
                synth.triggerAttackRelease("C4", "8n");
            } catch (e) { console.error("Audio playback failed", e); }
            
            setTimeout(() => {
                finalMessage.style.display = 'block';
                output.innerText = "DECODING COMPLETE.";
            }, 1500);
        } else {
            output.innerText = "Status: KEY REJECTED. DATA CORRUPTION LIKELY.";
        }
    }
    
    // --- Core Interaction Functions ---
    
    function triggerEnter(event) {
        if (event) event.preventDefault(); // Prevent <a> tag from navigating

        startPage.classList.remove('active');
        startPage.classList.add('hidden');
        
        archiveTerminal.style.opacity = 1;
        archiveTerminal.style.visibility = 'visible'; // Make visible
        archiveTerminal.classList.remove('hidden'); // No longer hidden
        
        document.body.style.overflow = 'auto'; // Allow scrolling
        isExperienceActive = true;
        
        // Initialize audio on the first user interaction
        initAudio(); 
        
        showSection('index-section'); // Start at the index
        
        requestAnimationFrame(animate);
    }
    
    function returnToStartPage() {
        isExperienceActive = false;
        document.body.style.overflow = 'hidden'; // Lock scroll again
        
        // Ensure container is visible 
        container.style.opacity = 1; 

        // Hide terminal and show start page
        archiveTerminal.style.opacity = 0;
        archiveTerminal.style.visibility = 'hidden'; // Hide
        archiveTerminal.classList.add('hidden');
        
        startPage.classList.remove('hidden');
        startPage.classList.add('active');
        
        // Stop audio when returning to the passive start screen
        if (staticSound) {
            // Tone.js stop() might not be immediate, lower volume too
            staticSound.volume.value = -Infinity;
        }
        
        // Reset all section content visibility
        // This ensures 'index-section' is active when we return
        showSection('index-section');
    }

    function doJumpScare() {
        // Stop current sounds
        if (staticSound) {
             staticSound.volume.value = -Infinity;
        }
        
        // 1. Go to black (container fade out)
        container.style.opacity = 0;
        
        // 2. Clear effects instantly
        rifts.forEach(r => r.style.opacity = 0);
        glitchTexts.forEach(g => g.style.opacity = 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height); 
        
        // 3. Jump Scare Sequence (Flash and Sound)
        try {
            if (!audioContextReady) initAudio(); // Must init for sound

            // High frequency noise burst (the sound scare)
            const highFreqNoise = new Tone.Noise('white').toDestination();
            highFreqNoise.volume.value = -10; 
            highFreqNoise.start();
            highFreqNoise.stop("+0.3"); 

            // Sustained white flash (the visual scare)
            flash.style.background = 'white';
            flash.style.transition = 'opacity 0.01s';
            flash.style.opacity = 1;
            
            setTimeout(() => {
                flash.style.opacity = 0;
                flash.style.background = 'black'; // Reset for black flashes later
            }, 300); // White flash duration
            
        } catch (e) { console.error('Audio failed:', e); }

        // 4. Fade back to the start page after the scare duration
        setTimeout(() => {
            returnToStartPage();
            // Re-fade container back in after the jump scare is over
            container.style.opacity = 1;
        }, 2000); // Total duration of black screen/scare before reset
    }

    function triggerLeave(event) {
        if (event) event.preventDefault(); // Prevent <a> tag from navigating

        // This is called by the "Disconnect" button on the start page
        if (isExperienceActive) {
            isExperienceActive = false;
            archiveTerminal.style.opacity = 0;
            archiveTerminal.classList.add('hidden');
        }
        doJumpScare();
    }

    // --- Drawing and Animation Loop ---

    function drawCorruption() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (!isExperienceActive) return;

        // Draw sparse, red data lines
        for(let i = 0; i < 35; i++){
            ctx.fillStyle = `rgba(255,0,0,${Math.random()*0.15})`;
            ctx.fillRect(
                Math.random() * canvas.width, 
                Math.random() * canvas.height, 
                Math.random() * 70, 
                Math.random() * 2
            );
        }
    }

    let lastTime = 0;
    function animate(time) {
        if (!isExperienceActive) {
            // Stop the loop if the experience is no longer active
            return;
        }
        
        // Ensure we have a time variable, even if rAF doesn't provide one
        if (!time) time = lastTime; 
        const timeSeconds = time * 0.001;
        lastTime = time;

        const scrollTop = window.scrollY || 0;
        const scrollLeft = window.scrollX || 0;

        // Rift animations (Parallax Dissonance Filter)
        rifts.forEach((rift, i) => {
            const offsetX = Math.sin(timeSeconds * 0.5 + i) * 30 + Math.sin(scrollTop * 0.005) * 50;
            const offsetY = Math.cos(timeSeconds * 0.4 + i) * 30 + Math.cos(scrollLeft * 0.005) * 50;
            const rotation = scrollTop * 0.02 + i * 15;
            rift.style.transform = `translate(${offsetX}px, ${offsetY}px) rotate(${rotation}deg) scale(${0.8 + Math.sin(timeSeconds * 0.2 + i) / 5})`;
        });

        // Glitch text flicker (Random)
        glitchTexts.forEach(g => {
            if(Math.random() < 0.015) {
                g.style.opacity = 0.5 + Math.random() * 0.5;
                g.style.top = Math.random() * 100 + 'vh';
                g.style.left = Math.random() * 100 + 'vw';
            } else {
                g.style.opacity = Math.max(0, g.style.opacity - 0.05); 
            }
        });

        // Flashing black effect (Quick Data Corruption)
        if(Math.random() < 0.005){
            flash.style.background = 'black';
            flash.style.opacity = 1;
            setTimeout(()=>{flash.style.opacity = 0}, 30);
        }

        drawCorruption();

        requestAnimationFrame(animate);
    }

    // --- Wait for DOM to be ready before running setup ---
    document.addEventListener('DOMContentLoaded', () => {
        // Call size calculation immediately when the page loads
        calculateFileSize();
        // Set initial canvas size
        resizeCanvas();
        // Add resize listener
        window.addEventListener('resize', resizeCanvas);

        // Set initial states for sections
        showSection('index-section'); // Ensure index is the default
        // Hide terminal until 'Enter' is clicked
        archiveTerminal.classList.add('hidden');
        archiveTerminal.style.visibility = 'hidden'; 
        startPage.classList.add('active'); // Show start page
    });

</script>
</body>
</html>
